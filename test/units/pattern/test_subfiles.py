from .. import TestUnitBase

import lzma


class TestSubFileUnit(TestUnitBase):

    def test_simple_zip(self):
        zip = bytes.fromhex(
            '504B03041400010000001505FA5496732F8E130000000700000008000000746573742E7478749C4E1F7FD879AA31F390F53C'
            'CD310BA615503F504B01023F001400010000001505FA5496732F8E1300000007000000080024000000000000002000000000'
            '000000746573742E7478740A00200000000000010018000C83349177A0D8010C83349177A0D801EA64048F77A0D801504B05'
            '0600000000010001005A000000390000000000')
        png = bytes.fromhex(
            '89504E470D0A1A0A0000000D494844520000000700000005080200000006F8618F000000017352474200AECE1CE900000004'
            '67414D410000B18F0BFC6105000000097048597300000EC300000EC301C76FA8640000001974455874536F66747761726500'
            '5061696E742E4E455420352E312E31318A0816CE000000B86558496649492A000800000005001A010500010000004A000000'
            '1B010500010000005200000028010300010000000200000031010200110000005A00000069870400010000006C0000000000'
            '0000600000000100000060000000010000005061696E742E4E455420352E312E313100000300009007000400000030323330'
            '01A00300010000000100000005A0040001000000960000000000000002000100020004000000523938000200070004000000'
            '30313030000000000635D473B28F723B0000002449444154185763608081FFFFFFC3D94C687C643636009147269918181818'
            '1919D1D401001D9911F692E8EAAD0000000049454E44AE426082')
        tar = lzma.decompress(bytes.fromhex(
            'FD377A585A000004E6D6B446020021011C00000010CF58CCE00BFF00525D00310B8A87C40EF297A4F875459F52BC0E0B16C0'
            'D79A185484DC28FE80927DA11B23C885AD20411CE06AA9D7E5DA347045E22229C866B7976CD5E9A843EC0C4C0968BC8CD3EC'
            '4837717E2BA36767F4268EA600000000EC88F6FFCEDFE78A00016E80180000001575E0D5B1C467FB020000000004595A'))

        data = (
            self.generate_random_buffer(200)
            + zip
            + self.generate_random_buffer(12)
            + png
            + self.generate_random_buffer(31)
            + tar
            + self.generate_random_buffer(14)
        )
        test = data | self.load() | {bytes}
        goal = {zip, tar, png}
        self.assertSetEqual(test, goal)
